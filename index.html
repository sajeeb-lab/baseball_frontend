<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>US Elite Baseball – Find Teams</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root {
  --navy:  #0a1628;
  --navy2: #0d1f3c;
  --red:   #c8102e;
  --red2:  #a50d25;
  --gold:  #f5c518;
  --white: #ffffff;
  --light: #f4f6f9;
  --mid:   #dce3ec;
  --text:  #1a1a2e;
  --sub:   #5a6a7a;
  --blue:  #1e56c8;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Open Sans', sans-serif; background: var(--light); color: var(--text); min-height: 100vh; }

.top-bar { background: var(--navy); padding: 6px 2rem; display: flex; justify-content: flex-end; align-items: center; gap: 1.4rem; }
.top-bar a { color: #8899bb; font-size: 0.68rem; text-decoration: none; letter-spacing: 0.07em; text-transform: uppercase; transition: color .2s; }
.top-bar a:hover { color: var(--gold); }

nav { background: var(--red); display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; box-shadow: 0 3px 14px rgba(0,0,0,.28); position: sticky; top: 0; z-index: 100; }
.nav-logo { display: flex; align-items: center; gap: .75rem; padding: 10px 0; text-decoration: none; }
.logo-icon { width: 46px; height: 46px; background: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'Oswald', sans-serif; font-weight: 700; font-size: .72rem; color: var(--red); line-height: 1.1; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,.2); flex-shrink: 0; }
.logo-text .main { display: block; font-family: 'Oswald', sans-serif; font-size: 1.2rem; font-weight: 700; color: var(--white); letter-spacing: .05em; text-transform: uppercase; line-height: 1; }
.logo-text .sub { display: block; font-size: .6rem; color: rgba(255,255,255,.7); letter-spacing: .18em; text-transform: uppercase; }
.nav-links { display: flex; list-style: none; }
.nav-links li a { display: block; padding: 18px 15px; color: var(--white); text-decoration: none; font-family: 'Oswald', sans-serif; font-size: .8rem; font-weight: 500; letter-spacing: .08em; text-transform: uppercase; border-bottom: 3px solid transparent; transition: background .18s, border-color .18s, color .18s; }
.nav-links li a:hover, .nav-links li a.active { background: rgba(0,0,0,.15); border-bottom-color: var(--gold); color: var(--gold); }

.hero { background: linear-gradient(135deg, var(--navy) 0%, #162845 100%); padding: 3rem 2rem 2.8rem; text-align: center; position: relative; overflow: hidden; }
.hero::before { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E"); }
.hero h1 { font-family: 'Oswald', sans-serif; font-size: clamp(1.8rem, 4vw, 3rem); font-weight: 700; color: var(--white); letter-spacing: .05em; text-transform: uppercase; margin-bottom: .5rem; position: relative; }
.hero h1 span { color: var(--gold); }
.hero p { color: rgba(255,255,255,.65); font-size: .92rem; margin-bottom: 1.8rem; position: relative; }

.search-wrap { position: relative; max-width: 520px; margin: 0 auto; display: flex; }
.search-wrap input { flex: 1; padding: 14px 18px; border: 2px solid rgba(255,255,255,.15); border-right: none; border-radius: 4px 0 0 4px; background: rgba(255,255,255,.08); color: var(--white); font-family: 'Open Sans', sans-serif; font-size: .9rem; outline: none; transition: border-color .2s, background .2s; }
.search-wrap input::placeholder { color: rgba(255,255,255,.4); }
.search-wrap input:focus { border-color: var(--gold); background: rgba(255,255,255,.12); }
.search-btn { padding: 14px 22px; background: var(--gold); border: none; border-radius: 0 4px 4px 0; cursor: pointer; font-family: 'Oswald', sans-serif; font-size: .82rem; font-weight: 600; color: var(--navy); letter-spacing: .1em; text-transform: uppercase; transition: background .2s; white-space: nowrap; }
.search-btn:hover { background: #ffd330; }

.main { max-width: 1100px; margin: 0 auto; padding: 2.5rem 1.5rem 4rem; }

.section-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.6rem; }
.section-header h2 { font-family: 'Oswald', sans-serif; font-size: 1.4rem; font-weight: 600; color: var(--navy); text-transform: uppercase; letter-spacing: .05em; white-space: nowrap; }
.section-header .bar { flex: 1; height: 2px; background: linear-gradient(to right, var(--red), transparent); }
.section-header .hint { font-size: .78rem; color: var(--sub); letter-spacing: .04em; white-space: nowrap; }

/* MAP */
.map-card { background: var(--white); border-radius: 6px; box-shadow: 0 2px 16px rgba(0,0,0,.08); padding: 1.8rem 1.5rem 1.2rem; margin-bottom: 2rem; border-top: 4px solid var(--red); }
.map-hint { text-align: center; color: var(--sub); font-size: .78rem; letter-spacing: .05em; margin-bottom: 1rem; text-transform: uppercase; }
#map-svg-container { width: 100%; }
#map-svg-container svg { width: 100%; height: auto; display: block; }
.state-path { fill: #111111; stroke: #ffffff; stroke-width: .8px; stroke-linejoin: round; cursor: pointer; transition: fill .15s ease; }
/* CHANGED: hover now shows blue */
.state-path:hover { fill: var(--blue); }
/* CHANGED: active (selected) also stays blue */
.state-path.active { fill: var(--blue); }
#map-loading { text-align: center; padding: 4rem 2rem; color: var(--sub); font-size: .9rem; letter-spacing: .05em; }

#map-tooltip { position: fixed; background: var(--navy); color: var(--white); font-family: 'Oswald', sans-serif; font-size: .9rem; font-weight: 500; letter-spacing: .08em; padding: 6px 14px; pointer-events: none; opacity: 0; transition: opacity .1s; z-index: 9999; white-space: nowrap; border-radius: 3px; transform: translate(-50%, -145%); text-transform: uppercase; }
#map-tooltip::after { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); border: 6px solid transparent; border-bottom: none; border-top-color: var(--navy); }
#map-tooltip.show { opacity: 1; }

/* RESULTS SECTION — hidden by default */
#results-section { display: none; animation: fadeUp .25s ease; }
#results-section.visible { display: block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

.results-header { background: var(--navy); color: var(--white); padding: 16px 22px; border-radius: 6px 6px 0 0; display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
.results-header h3 { font-family: 'Oswald', sans-serif; font-size: 1.2rem; font-weight: 600; letter-spacing: .06em; text-transform: uppercase; }
.results-meta { font-size: .75rem; color: rgba(255,255,255,.5); margin-top: 2px; }
.close-results-btn { background: rgba(255,255,255,.15); border: none; color: var(--white); width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; transition: background .2s; flex-shrink: 0; }
.close-results-btn:hover { background: var(--red2); }

/* TEAMS GRID */
.teams-grid { background: var(--white); border: 1px solid var(--mid); border-top: none; border-radius: 0 0 6px 6px; padding: 1.5rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; min-height: 80px; }

/* TEAM CARD */
.team-card { background: var(--light); border-radius: 10px; padding: 20px 22px 18px; border: 1px solid #e8ecf2; box-shadow: 0 1px 5px rgba(0,0,0,.04); text-decoration: none; display: block; color: inherit; transition: box-shadow .2s, transform .18s, border-color .18s; }
.team-card:hover { box-shadow: 0 6px 22px rgba(0,0,0,.1); transform: translateY(-2px); border-color: #c8d0dc; }
.tc-age { font-size: .74rem; font-weight: 700; color: var(--red); letter-spacing: .02em; margin-bottom: 6px; }
.tc-name { font-size: 1rem; font-weight: 700; color: var(--text); line-height: 1.3; margin-bottom: 4px; }
.tc-state { font-size: .84rem; color: var(--sub); }

/* SKELETON */
.skeleton { background: linear-gradient(90deg,#eee 25%,#f5f5f5 50%,#eee 75%); background-size: 200% 100%; animation: shimmer 1.2s infinite; border-radius: 10px; height: 100px; }
@keyframes shimmer { from{background-position:200% 0} to{background-position:-200% 0} }

.empty-state { grid-column:1/-1; text-align:center; padding:3rem 1rem; color:var(--sub); font-size:.92rem; }
.empty-state strong { display:block; font-size:1rem; color:var(--navy); margin-bottom:.4rem; }
.error-state { grid-column:1/-1; background:#fff5f5; border:1px solid #ffc0c0; border-radius:8px; padding:2rem; text-align:center; color:var(--red); font-size:.9rem; }
.error-state strong { display:block; margin-bottom:.4rem; }

footer { background:var(--navy); color:rgba(255,255,255,.5); text-align:center; padding:2.5rem 2rem; font-size:.72rem; letter-spacing:.08em; margin-top:3rem; }
.footer-links { display:flex; justify-content:center; flex-wrap:wrap; gap:.4rem 1.4rem; margin-bottom:1.2rem; }
.footer-links a { color:rgba(255,255,255,.45); font-size:.68rem; text-transform:uppercase; letter-spacing:.1em; text-decoration:none; transition:color .2s; }
.footer-links a:hover { color:var(--gold); }
footer a { color:var(--gold); text-decoration:none; }
footer p { line-height:1.8; }

@media (max-width:720px) {
  .teams-grid { grid-template-columns:1fr; }
  .top-bar { display:none; }
  .nav-links li a { padding:18px 10px; font-size:.72rem; }
  .main { padding:1.5rem 1rem 3rem; }
}
</style>
</head>
<body>

<div class="top-bar">
  <a href="#">Prospect Form</a>
  <a href="#">Coach Application</a>
  <a href="#">Mission Statement</a>
  <a href="#">Contact US Elite</a>
</div>

<nav>
  <a href="index.html" class="nav-logo">
    <div class="logo-icon">US<br>ELITE</div>
    <div class="logo-text">
      <span class="main">US Elite Baseball</span>
      <span class="sub">Uncommon Standards</span>
    </div>
  </a>
  <ul class="nav-links">
    <li><a href="index.html" class="active">US Elite Teams</a></li>
    <li><a href="#">Commitments</a></li>
    <li><a href="#">Tryouts</a></li>
    <li><a href="#">Privacy Policy</a></li>
  </ul>
</nav>

<div class="hero">
  <h1>Find <span>US Elite</span> Teams</h1>
  <p>Click any state on the map — or search by state name below</p>
  <div class="search-wrap">
    <input type="text" id="search-input" placeholder="Search by state name or abbreviation…" autocomplete="off">
    <button class="search-btn" onclick="doSearch()">Search</button>
  </div>
</div>

<div class="main">

  <!-- MAP -->
  <div class="section-header">
    <h2>Select a State</h2>
    <div class="bar"></div>
    <span class="hint">Click any state to view teams</span>
  </div>

  <div class="map-card">
    <p class="map-hint">⚾ Click a state on the map to load teams</p>
    <div id="map-svg-container">
      <div id="map-loading">Loading map…</div>
    </div>
  </div>

  <!-- RESULTS — hidden until triggered -->
  <div id="results-section">
    <div class="results-header">
      <div>
        <h3 id="results-title">Teams</h3>
        <div class="results-meta" id="results-meta"></div>
      </div>
      <button class="close-results-btn" onclick="closeResults()" title="Close">✕</button>
    </div>
    <div class="teams-grid" id="teams-grid"></div>
  </div>

</div>

<footer>
  <div class="footer-links">
    <a href="#">US Elite Teams</a><a href="#">Commitments</a><a href="#">Privacy Policy</a>
    <a href="#">Prospect Form</a><a href="#">Tryouts</a><a href="#">Coach Application</a>
    <a href="#">Mission Statement</a><a href="#">Contact US Elite</a>
  </div>
  <p>We are always looking for new talent. Do you feel you have what it takes?<br>
    <a href="#">Click here to register for an upcoming tryout!</a></p>
  <p style="margin-top:.8rem;color:rgba(255,255,255,.35)">
    Copyright &copy; 2026 US Elite Baseball &nbsp;&middot;&nbsp;
    <a href="mailto:support@uselitebaseball.com">support@uselitebaseball.com</a>
  </p>
</footer>

<div id="map-tooltip" role="tooltip"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
<script>
'use strict';

const API_BASE = 'https://baseball-backend-five.vercel.app';

const STATE_NAMES = {
  "01":"Alabama","02":"Alaska","04":"Arizona","05":"Arkansas","06":"California",
  "08":"Colorado","09":"Connecticut","10":"Delaware","12":"Florida","13":"Georgia",
  "15":"Hawaii","16":"Idaho","17":"Illinois","18":"Indiana","19":"Iowa",
  "20":"Kansas","21":"Kentucky","22":"Louisiana","23":"Maine","24":"Maryland",
  "25":"Massachusetts","26":"Michigan","27":"Minnesota","28":"Mississippi",
  "29":"Missouri","30":"Montana","31":"Nebraska","32":"Nevada","33":"New Hampshire",
  "34":"New Jersey","35":"New Mexico","36":"New York","37":"North Carolina",
  "38":"North Dakota","39":"Ohio","40":"Oklahoma","41":"Oregon","42":"Pennsylvania",
  "44":"Rhode Island","45":"South Carolina","46":"South Dakota","47":"Tennessee",
  "48":"Texas","49":"Utah","50":"Vermont","51":"Virginia","53":"Washington",
  "54":"West Virginia","55":"Wisconsin","56":"Wyoming"
};

const STATE_ABBR = {
  "01":"AL","02":"AK","04":"AZ","05":"AR","06":"CA","08":"CO","09":"CT",
  "10":"DE","12":"FL","13":"GA","15":"HI","16":"ID","17":"IL","18":"IN",
  "19":"IA","20":"KS","21":"KY","22":"LA","23":"ME","24":"MD","25":"MA",
  "26":"MI","27":"MN","28":"MS","29":"MO","30":"MT","31":"NE","32":"NV",
  "33":"NH","34":"NJ","35":"NM","36":"NY","37":"NC","38":"ND","39":"OH",
  "40":"OK","41":"OR","42":"PA","44":"RI","45":"SC","46":"SD","47":"TN",
  "48":"TX","49":"UT","50":"VT","51":"VA","53":"WA","54":"WV","55":"WI",
  "56":"WY"
};

const ABBR_TO_NAME = {};
Object.entries(STATE_ABBR).forEach(([id, abbr]) => { ABBR_TO_NAME[abbr] = STATE_NAMES[id]; });

const ALL_STATES = Object.entries(STATE_NAMES).map(([id, name]) => ({
  id, name, abbr: STATE_ABBR[id]
}));

function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

let svgRef = null;
const mapTooltip = document.getElementById('map-tooltip');

// ── FETCH & SHOW TEAMS FOR A STATE ───────────────────────────────────────────
async function openState(abbr, name) {
  const section  = document.getElementById('results-section');
  const grid     = document.getElementById('teams-grid');
  const title    = document.getElementById('results-title');
  const meta     = document.getElementById('results-meta');

  // Show panel with loading skeletons immediately
  title.textContent = `Teams in ${name} (${abbr})`;
  meta.textContent  = 'Loading teams…';
  grid.innerHTML    = Array(4).fill('<div class="skeleton"></div>').join('');
  section.classList.add('visible');

  // Scroll to results
  setTimeout(() => section.scrollIntoView({ behavior: 'smooth', block: 'start' }), 50);

  try {
    const res  = await fetch(`${API_BASE}/api/teams?state=${encodeURIComponent(abbr)}`);
    const data = await res.json();
    const teams = data.teams || [];

    meta.textContent = teams.length > 0
      ? `${teams.length} team${teams.length !== 1 ? 's' : ''} found`
      : 'No teams found';

    if (!teams.length) {
      grid.innerHTML = `<div class="empty-state"><strong>No teams found in ${esc(name)}</strong>There are currently no teams listed for this state.</div>`;
      return;
    }

    // Sort by team name
    teams.sort((a,b) => (a.teamName||'').localeCompare(b.teamName||''));

    grid.innerHTML = '';
    teams.forEach(team => {
      const fullState = ABBR_TO_NAME[team.state] || team.state;
      const ageLine   = team.ageGroup ? `<div class="tc-age">${esc(team.ageGroup)}</div>` : '';
      const params    = new URLSearchParams({ id: team.id, name: team.teamName, state: team.state });
      const card      = document.createElement('a');
      card.className  = 'team-card';
      card.href       = `team.html?${params}`;
      card.innerHTML  = `${ageLine}<div class="tc-name">${esc(team.teamName)}</div><div class="tc-state">${esc(fullState)}</div>`;
      grid.appendChild(card);
    });

  } catch(err) {
    meta.textContent = '';
    grid.innerHTML = `<div class="error-state"><strong>⚠️ Failed to load teams</strong>${esc(err.message)}</div>`;
  }
}

// ── CLOSE RESULTS ────────────────────────────────────────────────────────────
function closeResults() {
  document.getElementById('results-section').classList.remove('visible');
  // CHANGED: also clear active state on map and reset search bar
  if (svgRef) svgRef.selectAll('.state-path').classed('active', false);
  document.getElementById('search-input').value = '';
}

// ── SEARCH ───────────────────────────────────────────────────────────────────
function doSearch() {
  const q = document.getElementById('search-input').value.trim().toLowerCase();
  if (!q) return;

  // Try exact match first (abbr or full name)
  let match = ALL_STATES.find(s =>
    s.name.toLowerCase() === q || s.abbr.toLowerCase() === q
  );

  // Then partial match
  if (!match) {
    match = ALL_STATES.find(s =>
      s.name.toLowerCase().startsWith(q) || s.abbr.toLowerCase().startsWith(q)
    );
  }

  if (match) {
    // Highlight on map
    if (svgRef) {
      svgRef.selectAll('.state-path').classed('active', d =>
        STATE_ABBR[d.id.toString().padStart(2,'0')] === match.abbr
      );
    }
    openState(match.abbr, match.name);
  }
}

document.getElementById('search-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') doSearch();
});

// ── MAP ───────────────────────────────────────────────────────────────────────
async function initMap() {
  try {
    const us = await d3.json('https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json');
    const loadingEl = document.getElementById('map-loading');
    if (loadingEl) loadingEl.remove();

    const W = 960, H = 580;
    const svg = d3.select('#map-svg-container')
      .append('svg')
      .attr('viewBox', `0 0 ${W} ${H}`)
      .attr('aria-label', 'Interactive USA map');
    svgRef = svg;

    const projection = d3.geoAlbersUsa().scale(1280).translate([W/2, H/2]);
    const pathGen    = d3.geoPath().projection(projection);
    const states     = topojson.feature(us, us.objects.states);

    svg.selectAll('.state-path')
      .data(states.features)
      .join('path')
      .attr('class', 'state-path')
      .attr('d', pathGen)
      .attr('aria-label', d => STATE_NAMES[d.id.toString().padStart(2,'0')] || '')
      .on('mouseenter', function(event, d) {
        const id = d.id.toString().padStart(2,'0');
        if (!STATE_ABBR[id]) return;
        mapTooltip.textContent = `${STATE_ABBR[id]} — ${STATE_NAMES[id]}`;
        mapTooltip.classList.add('show');
      })
      .on('mousemove', function(event) {
        mapTooltip.style.left = event.clientX + 'px';
        mapTooltip.style.top  = event.clientY + 'px';
      })
      .on('mouseleave', function() { mapTooltip.classList.remove('show'); })
      .on('click', function(event, d) {
        const id   = d.id.toString().padStart(2,'0');
        const abbr = STATE_ABBR[id];
        const name = STATE_NAMES[id];
        if (!abbr) return;

        svg.selectAll('.state-path').classed('active', false);
        d3.select(this).classed('active', true);

        // CHANGED: update the search bar to reflect the selected state
        document.getElementById('search-input').value = name;

        openState(abbr, name);
      });

  } catch(err) {
    const loadingEl = document.getElementById('map-loading');
    if (loadingEl) { loadingEl.textContent = '⚠️ Failed to load map.'; loadingEl.style.color = 'var(--red)'; }
    console.error('[initMap error]', err);
  }
}

initMap();
</script>
</body>
</html>
